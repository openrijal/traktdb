---
import AppLayout from "@/layouts/AppLayout.astro";
import LibraryPage from "@/components/library/LibraryPage.vue";
import { createAuth } from "@/lib/auth";

const env = Astro.locals.runtime?.env || import.meta.env;
const auth = createAuth(env);

const session = await auth.api.getSession({ headers: Astro.request.headers });
if (!session) {
    return Astro.redirect("/login");
}

const { section } = Astro.params;
const allowedSections = ['movies', 'shows', 'books', 'ebooks', 'podcasts'];

if (!section || !allowedSections.includes(section)) {
    return Astro.redirect('/library/movies');
}
---

<AppLayout>
    <LibraryPage client:load initialSection={section} />
</AppLayout>
